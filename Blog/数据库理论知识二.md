## 第三章  数据库标准语言SQL
### 3.1SQL概述

* SQL（Structured Query Language）：简单易学、功能丰富
### 3.2数据定义
* 建表
![avatar](http://118.31.20.205:8888/images/3.2.1.png)
![avatar](http://118.31.20.205:8888/images/3.2.2.png)
![avatar](http://118.31.20.205:8888/images/3.2.3.png)
* 修改表
![avatar](http://118.31.20.205:8888/images/3.2.4.png)
* 索引
    * 在关系数据库种，索引是一种单独的】无力的、虽数据库表中一列或者多列的值进行排序的一种存储结构
    * 他是某个表中一列或者若干列值的集合和响应的指向表中物理标识这些值的数据页的逻辑指针清单
    * 建立索引是加快查询速度的有效手段
* 建立索引
    * DBA或表得到属主根据需要建立
    * 有些DBMMS自动建议一下列上的索引
        * Primary key
        * Unique
* 维护
    * DBMS自动完成索引的维护
* 使用
    * DBMS自动选择是否使用索引以及使用那些索引
* 顾虑
    * 会占用一定空间
    * 对数据增删改操作需要对索引维护
    * 确保提高性能的情况下再建立索引
* 索引的创建
    * 直接方法 建表的时候就创建
    * 间接方法 建好表之后加入
    ![avatar](http://118.31.20.205:8888/images/3.2.5.png)
     unique是唯一取值的索引 bitmap是列下值不唯一时创建索引
*  索引修改
![avatar](http://118.31.20.205:8888/images/3.2.6.png)
*  删除索引
![avatar](http://118.31.20.205:8888/images/3.2.7.png)
### 3.3数据查询
#### 单表查询
![avatar](http://118.31.20.205:8888/images/3.3.1.png)
all查询全部数据
distinct 去掉重复列

* 选择表中的若干列
	*  消除取值重复的行 select  disnect 列名 from表名
	![avatar](http://118.31.20.205:8888/images/3.3.2.png)
* 查询全部列
select * from <表名>

* 查询经过计算的列
 to_char(列名，日期格式)（+起个列名）

*  选择表中的若干元组
    *  消除取值重复的行 select  disnect 列名 from表名
	![avatar](http://118.31.20.205:8888/images/3.3.3.png)
	* 排序查询：

asc：升序 控制的元组最后显示
desc：降序 空值的元组最先显示

* 使用集函数
    * 计数 count（【distinct|all* 】）
    * 计算总和  sum（[distinct|all]<列名>）
    * 计算平均值 avg([distinct|all<列名>])
    * 最大值 max ([distinct|all<列名>])
    * 最小值min ([distinct|all<列名>])
 * eg：select avg （grade）from sc where cno=‘001’  
 * 对查询结果分组 ： group by
     * 分组结果进行筛选：having短句

| having                                            | where                                    |
| ------------------------------------------------- | ---------------------------------------- |
| where子句作用于基表或视图，从中选择满足条件的元组 | having短语作用于组，从中选择满足条件的组 |

#### 连接查询

* 等值于非等值连接  where 条件为 =或者 非=
* 自身连接：
	![avatar](http://118.31.20.205:8888/images/3.3.4.png)
#### 嵌套查询
一个select-from-where语句称为一个查询块
将一个查询块嵌套到另一个查询块的where子句或having短语的条件中的查询称为嵌套查询
    子查询不能使用orderby语句
#### 集合查询

* 并
	![avatar](http://118.31.20.205:8888/images/3.3.6.png)



* 交
	![avatar](http://118.31.20.205:8888/images/3.3.7.png)

* 差
	![avatar](http://118.31.20.205:8888/images/3.3.8.png)
### 3.4数据更新

* 增
    * 注意如果需要插入日期类型的 则需要用 to_date('',格式)转换成日期类型的
* 删
	![avatar](http://118.31.20.205:8888/images/3.4.1.png)
* 改
* update
	![avatar](http://118.31.20.205:8888/images/3.4.2.png)
### 3.5视图

* 定义：视图是从一个或者几个基本表（或视图）导出的表，他与基本表不同，他是一个虚表
    * 数据库中只存放使徒的定义，而不存放视图对应的数据，这些数据仍存放在原来的基本表中
    * 基本标中数据发生变化，从视图中查询出得到数据也随之改变
* 创建视图：
	![avatar](http://118.31.20.205:8888/images/3.5.1.png)

with check option：加上的话更新视图数据必须满足插入数据的条件

* 删除视图
	![avatar](http://118.31.20.205:8888/images/3.5.2.png)

* 常见视图
	![avatar](http://118.31.20.205:8888/images/3.5.3.png)

* 行列子集视图：若一个表是从党额基本标导出，只是去掉了基本标的某些行和列，但保留了主码，则这类视图为行列子集视图

**总结**
	![avatar](http://118.31.20.205:8888/images/zj3.png)
## 第四章 数据库安全性概述
### 4.1数据库安全性概述
为了适应和满足数据共享的环境和要求，DMBMS要保证整个系统的正常运转，防止数据泄露，恶意修改，不一致产生，产生问题后的及时回复，需要一整套而有效的保护措施
*    DBMS对数据安全的保护功能：
    *    安全性控制：   方式数据泄露恶意修改
    *    完整性控制：   防止数据的不一致性
    *    并发性控制：   防止数据的不一致性
    *    数据库恢复：   产生问题后的及时恢复

### 安全控制机制 

* 数据库的安全性：保护数据库以防止非法使用所造成的数据泄露、更改或破坏
* 安全性控制的主要问题：尽可能杜绝所有可能的数据库非法访问
	![avatar](http://118.31.20.205:8888/images/4.1.1.png)
* 数据库安全性控制手段：
    * 用户标识和鉴定
        * 由系统提供一定的方式让用户表示自己的名字或身份，系统内部记录着所有合法用户的标识
        * 没此用户要求进入系统时，由系统进行核实，通过鉴定后才提供机器的使用权
        * 缺点：
            * 简单易行但是用户口令比较简单容易被窃取
    * 用户存取权限控制
		![avatar](http://118.31.20.205:8888/images/4.1.2.png)
		* 比较消耗时间
    * 定义视图
        * 为不同的用户定义不同的视图，可以限制各个用户的访问范围
        * 视图是逻辑存在的，其修改操作会受到限制
    * 数据加密
        * 根据一定算法将原始数据加密成为不可直接识别的格式，数据以密文的形式存储和运输
            * 替换方法：使用密钥将明文中的每一个字符换为密文中的字符
            * 转换方法：将明文中的字符按不同的顺序重新排列
    * 数据审计
        * 监视措施：把访问数据库的操作记录下来，并把日志返回给管理员
* SQL Server数据安全机制
    * 服务器级别的安全性
    * 数据库及其对象的安全性

### 设置验证身份模式

* SQL Server的身份验证模式
    * Windows身份验证模式
    * 混合身份验证模式
* 身份验证模式的设置 

### 服务器级安全管理

* SQL Server登陆账号的相关操作
    * 登陆账号
    * 数据库用户账号
	![avatar](http://118.31.20.205:8888/images/4.1.3.png)
* SQL Server身份验证模式
* SQLServer度武器角色

### 设置登录账号和角色

* SQL Server中账号的类型
* 创建登陆账号
* 修改登陆账号
* 删除登陆账号
* 服务器角色

### 数据库级安全管理

* 数据库用户账号
    * 用户账号要在特定的数据库内创建，并关联一个登陆账号
    * ![avatar](http://118.31.20.205:8888/images/4.1.4.png)
    * 可以使用‘对象资源管理器’创建
    * 设置映射，用户账号可以使用管理那些数据库


### 设置用户账号

*    用户账号和登陆账号的区别
*    创建数据库用户账号
*    查看和修改数据库用户账号
*    删除数据库用户账号
*    数据库用户角色