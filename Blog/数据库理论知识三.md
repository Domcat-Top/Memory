 ## 第五章数据库完整性
  数据库的完整性是指数据的正确行和有效性。是指数据是符合显示世界语义、反映当前实际状况的 
  通过对关系（二维表） 中取值的约束，可以保证数据库的完整性，保证数据的正确性
 ### 实体完整性（主键）

*  列级约束
    *  创建表时写在列后边
*  表级约束
    *  创建好表后在写PRIMARY KRY( ，)
* 实体完整性的检查和违约处理

| 数据操作 | 是否违反实体完整性 | 违约处理 |
| -------- | ------------------ | -------- |
| 删除     | 否                 |          |
| 插入     | 有可能             | 拒绝     |
| 修改     | 有可能             | 拒绝     |
| 查询     | 否                 |          |

  ### 参照完整性（外键）

*   参照完整性的规则： 若属性F是基本关系R的外码，他与基本关系S的主码Ks相对应，则对于R中每个元组在F上的值 要么取空要么等于S中某个元组的主码值
![avatar](http://118.31.20.205:8888/images/5.1.1.png)
* 参照完整性的检查和违约处理

| 主键关系学生表                                        | 外键关系选课表       | 违约处理               |
| ----------------------------------------------------- | -------------------- | ---------------------- |
| 删除元组                                              | 可能破坏参照完整性   | 拒绝/级联删除/设置空值 |
| 有可能破坏参照完整性                                  | 插入元组             | 拒绝                   |
| 修改主码值                                            | 有可能破坏参照完整性 | 拒绝/级联更新/设置空值 |
| 有可能破坏参照完整性                                  | 修改外码值           | 拒绝                   |
| ![avatar](http://118.31.20.205:8888/images/5.1.2.png) |                      |                        |

  ### 用户定义的完整性

*   用户定义完整性规则：
    *   用户定义的完整性是针对某一具体关系数据库的约束条件反应某一具体应用所设计的数据必须满足语义要求
    *   用户定义的完整性没有统一的语义要求来创建
    *   eg：成绩的取值范围 由用户定义
* 实现：
    * 在 CREAT TABLE时可以用CHECK短语定义元组上的约束条件，即元组级的限制
    * 同属性值限制相比，元组级的限制可以设置不同属性之间取值的相互约束条件
* 违规处理
    * 插入元祖和修改属性的值时，RDBMS检查属性上的约束条件是否被满足
    * 如果不满足则操作被拒绝执行
    * | 数据操作 | 是否违反实体完整性  | 违约处理 |
	
| 数据操作 | 是否违反实体完整性 | 违约处理 |
| -------- | ------------------ | -------- |
| 删除     | 否                 |          |
| 插入     | 有可能             | 拒绝     |
| 修改     | 有可能             | 拒绝     |
| 查询     | 否                 |          |

  ### 完整性约束命名子句
  给完整性约束起名字：CONSTARAINT +约束名+约束条件
  ![avatar](http://118.31.20.205:8888/images/5.1.3.png)
  ![avatar](http://118.31.20.205:8888/images/5.1.4.png)
   ## 第六章 -->无

  ## 第七章
  ### 问题的提出（规范化）

*   数据冗余
*   更新异常
*   插入异常
*   删除异常
#### 规范化

* 规范化概念：是关系模式优化的理论基础
  
* 基本思想：通过关系模式垂直分解来消除数据项之间的饿不合适的数据依赖，防止插入异常、查出一场和数据荣誉等异常的发生
* 函数依赖  * 忽* 略 * 了
* 范式： 关系数据库中的关系必须满足一定的要求，满足不同程度要求就称为不同的范式，用R∈xNF描述
    * x标识范式的级别
	  ![avatar](http://118.31.20.205:8888/images/7.1.png)
	   * 一个低一级的范式的关系模式，通过模式垂直分解的方法，转换为若干个高一级范式的关系模式的集合，这种过程称为规范化
        * 遵照原则：一事一地原则
        * 解决方法：模式垂直分解
        * 分解时注意：
            * 保持函数依赖的分解：指在模式分解的过程中函数依赖不能丢失特性，即模式分解不能破坏原来的语义
            * 保持数据不丢失的分解：分解后额杜关系通过自然连接可以恢复成原来的关系，既不多出信息，又不丢失信息
   * 1NF ：如果一个关系模式R的所有属性值（分量）均为原子项，则称R∈1NF
       * 第一范式时对关系模式最起码的要求。不满足第一范式的数据库模式不能称为关系数据库
       * 满足第一范式的关系模式，并不一定是一个好的关系模式
   * 2NF：若关系 R∈1NF，且每一个非主属性均完全函数依赖于R的关系码，则R∈2NF
   * 3NF：舍关系模式<U,F>∈1NF，若R中不存在所有的非主属性对码的传递函数依赖，则称R<U,F>∈3NF
  
    ### 数据依赖公理系统
    
*   Armstrong公理系统
    *   函数依赖的逻辑蕴含
    *   Armstrong公理系统中推理规则；
    *   计算机属性集的闭包
    *   计算最小函数依赖集
    *   求解关系模式的候选码的方法
### 模式分解

*   对于一个模式的分解是多种多样的，但分解后产生的模式应与原模式等价
*   模式分解要满足：
    *   具有无损连接性
        *   指分解后的关系通过自然连接具有和原关系等价的特性，即通过自然连接得到的关系与原来的关系相比，既不多出信息、又不丢失信息
    *   保持函数依赖
    *   判断是否为模式分解
        *   生成空表格
        ![avatar](http://118.31.20.205:8888/images/7.2.png)
        *   按照算法填写表格
        ![avatar](http://118.31.20.205:8888/images/7.3.png)
        ![avatar](http://118.31.20.205:8888/images/7.4.png)
        *   应用每一个函数依赖关系修正表格
         ![avatar](http://118.31.20.205:8888/images/7.5.png)
        ![avatar](http://118.31.20.205:8888/images/7.6.png)
        *   以找算法要求，得出结论
        ![avatar](http://118.31.20.205:8888/images/7.7.png)
        *  eg:看有没有AB两行相同而他的C行之不一样
         ![avatar](http://118.31.20.205:8888/images/7.8.png)

** 小结**
 ![avatar](http://118.31.20.205:8888/images/zj7.png)